<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Light One Candle</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Lora:ital,wght@0,400;0,600;1,400&display=swap');

        body {
            background-color: #050510;
            color: #fefefe;
            font-family: 'Lora', serif;
            overflow: hidden;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
        }

        .font-title {
            font-family: 'Cinzel', serif;
        }

        /* Candle Flicker Animation */
        @keyframes flicker {
            0%, 100% { transform: scale(1); opacity: 0.9; }
            25% { transform: scale(1.05); opacity: 0.8; }
            50% { transform: scale(0.95); opacity: 1; }
            75% { transform: scale(1.02); opacity: 0.85; }
        }

        @keyframes flame-move {
            0%, 100% { transform: rotate(-2deg); }
            50% { transform: rotate(2deg); }
        }

        @keyframes glow-pulse {
            0%, 100% { box-shadow: 0 0 40px 10px rgba(255, 200, 100, 0.3); }
            50% { box-shadow: 0 0 50px 15px rgba(255, 220, 120, 0.5); }
        }

        .candle-flame {
            animation: flicker 2s infinite alternate, flame-move 3s infinite ease-in-out;
            transform-origin: center bottom;
        }

        .candle-glow {
            animation: glow-pulse 4s infinite ease-in-out;
        }

        /* Star Animation */
        @keyframes twinkle {
            0%, 100% { opacity: 0.3; transform: scale(0.8); }
            50% { opacity: 1; transform: scale(1.2); }
        }

        .star {
            animation: twinkle 4s infinite ease-in-out;
        }

        /* Fade In Utils */
        .fade-in {
            animation: fadeIn 1.5s ease-out forwards;
        }
        
        .fade-in-slow {
            animation: fadeIn 3s ease-out forwards;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Darkness overlay transition */
        .darkness-overlay {
            transition: background-color 2s ease-in-out;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo } = React;

        // --- Audio Manager (Web Audio API) ---
        // Generates soft sounds without external files
        class AudioManager {
            constructor() {
                this.ctx = null;
                this.oscillators = [];
                this.gainNode = null;
                this.isMuted = false;
            }

            init() {
                if (!this.ctx) {
                    this.ctx = new (window.AudioContext || window.webkitAudioContext)();
                    this.gainNode = this.ctx.createGain();
                    this.gainNode.connect(this.ctx.destination);
                    this.gainNode.gain.value = 0.3;
                }
                if (this.ctx.state === 'suspended') {
                    this.ctx.resume();
                }
            }

            playPad() {
                if (!this.ctx) return;
                // Create a chord (C Major add 9)
                const freqs = [130.81, 196.00, 261.63, 329.63, 392.00]; 
                
                freqs.forEach((f, i) => {
                    const osc = this.ctx.createOscillator();
                    const gain = this.ctx.createGain();
                    
                    osc.type = 'sine';
                    osc.frequency.value = f;
                    
                    // LFO for movement
                    const lfo = this.ctx.createOscillator();
                    lfo.frequency.value = 0.1 + (Math.random() * 0.1);
                    const lfoGain = this.ctx.createGain();
                    lfoGain.gain.value = 50;
                    lfo.connect(lfoGain).connect(osc.frequency);
                    lfo.start();

                    gain.gain.setValueAtTime(0, this.ctx.currentTime);
                    gain.gain.linearRampToValueAtTime(0.05 / (i+1), this.ctx.currentTime + 4); // Soft attack
                    
                    osc.connect(gain);
                    gain.connect(this.gainNode);
                    osc.start();
                    this.oscillators.push({osc, gain, lfo});
                });
            }

            playChime() {
                if (!this.ctx) return;
                const osc = this.ctx.createOscillator();
                const gain = this.ctx.createGain();
                
                osc.type = 'triangle';
                osc.frequency.setValueAtTime(523.25 + (Math.random() * 200), this.ctx.currentTime); // Random high note
                
                gain.gain.setValueAtTime(0, this.ctx.currentTime);
                gain.gain.linearRampToValueAtTime(0.2, this.ctx.currentTime + 0.05);
                gain.gain.exponentialRampToValueAtTime(0.001, this.ctx.currentTime + 3);
                
                osc.connect(gain);
                gain.connect(this.gainNode);
                osc.start();
                osc.stop(this.ctx.currentTime + 3.5);
            }

            playAngelChord() {
                if (!this.ctx) return;
                const freqs = [523.25, 659.25, 783.99, 1046.50]; // High C Major
                freqs.forEach((f) => {
                     const osc = this.ctx.createOscillator();
                     const gain = this.ctx.createGain();
                     osc.type = 'sine';
                     osc.frequency.value = f;
                     gain.gain.setValueAtTime(0, this.ctx.currentTime);
                     gain.gain.linearRampToValueAtTime(0.1, this.ctx.currentTime + 2);
                     gain.gain.exponentialRampToValueAtTime(0.001, this.ctx.currentTime + 8);
                     osc.connect(gain);
                     gain.connect(this.gainNode);
                     osc.start();
                     osc.stop(this.ctx.currentTime + 8);
                });
            }
        }

        const audioManager = new AudioManager();

        // --- Snow Component ---
        const Snow = () => {
            const canvasRef = useRef(null);

            useEffect(() => {
                const canvas = canvasRef.current;
                const ctx = canvas.getContext('2d');
                let width = window.innerWidth;
                let height = window.innerHeight;
                canvas.width = width;
                canvas.height = height;

                const particles = [];
                const particleCount = 60;

                for (let i = 0; i < particleCount; i++) {
                    particles.push({
                        x: Math.random() * width,
                        y: Math.random() * height,
                        r: Math.random() * 2 + 1,
                        d: Math.random() * particleCount,
                        speed: Math.random() * 0.5 + 0.2
                    });
                }

                function draw() {
                    ctx.clearRect(0, 0, width, height);
                    ctx.fillStyle = "rgba(255, 255, 255, 0.6)";
                    ctx.beginPath();
                    for (let i = 0; i < particleCount; i++) {
                        const p = particles[i];
                        ctx.moveTo(p.x, p.y);
                        ctx.arc(p.x, p.y, p.r, 0, Math.PI * 2, true);
                    }
                    ctx.fill();
                    update();
                    requestAnimationFrame(draw);
                }

                function update() {
                    for (let i = 0; i < particleCount; i++) {
                        const p = particles[i];
                        p.y += p.speed;
                        p.x += Math.sin(p.d) * 0.5;
                        
                        if (p.y > height) {
                            particles[i] = { x: Math.random() * width, y: -10, r: p.r, d: p.d, speed: p.speed };
                        }
                    }
                }
                
                draw();

                const handleResize = () => {
                    width = window.innerWidth;
                    height = window.innerHeight;
                    canvas.width = width;
                    canvas.height = height;
                };

                window.addEventListener('resize', handleResize);
                return () => window.removeEventListener('resize', handleResize);
            }, []);

            return <canvas ref={canvasRef} className="absolute top-0 left-0 w-full h-full pointer-events-none z-0" />;
        };

        // --- Candle Graphic Component ---
        const CandleGraphic = ({ scale = 1, isLit = true }) => {
            return (
                <div className="relative flex flex-col items-center" style={{ transform: `scale(${scale})` }}>
                    {/* Flame */}
                    {isLit && (
                        <div className="absolute -top-12 w-8 h-12 z-20 candle-flame">
                            <div className="w-full h-full bg-gradient-to-t from-orange-500 via-yellow-300 to-white rounded-full opacity-90 blur-[2px]"></div>
                        </div>
                    )}
                    {/* Glow */}
                    {isLit && (
                        <div className="absolute -top-16 w-32 h-32 rounded-full bg-yellow-500 opacity-20 blur-2xl z-10 candle-glow"></div>
                    )}
                    {/* Wax Body */}
                    <div className="w-10 h-24 bg-gradient-to-b from-amber-100 to-amber-200 rounded-lg shadow-lg relative z-10 border-t-4 border-amber-50">
                        {/* Drips */}
                        <div className="absolute top-0 left-2 w-1 h-6 bg-amber-100 rounded-b-full opacity-80"></div>
                        <div className="absolute top-0 right-3 w-1.5 h-4 bg-amber-100 rounded-b-full opacity-80"></div>
                    </div>
                    {/* Base Shadow */}
                    <div className="absolute bottom-0 w-16 h-4 bg-black opacity-30 blur-md rounded-full"></div>
                </div>
            );
        };

        // --- Main App ---
        const App = () => {
            const [screen, setScreen] = useState('start'); // start, experience, final
            const [name, setName] = useState('Friend'); // Default to friend since we removed input
            const [candles, setCandles] = useState([]);
            const [opacity, setOpacity] = useState(0.95); // Background darkness opacity
            const [showQuote, setShowQuote] = useState(false);
            
            // Defines the sequence of candles
            const sequence = [
                { id: 1, title: 'Hope', verse: 'Romans 15:13', text: 'May the God of hope fill you with all joy and peace...', pos: 'top-1/4 left-8' },
                { id: 2, title: 'Peace', verse: 'John 14:27', text: 'Peace I leave with you; my peace I give you.', pos: 'bottom-1/3 right-8' },
                { id: 3, title: 'Joy', verse: 'Philippians 4:4', text: 'Rejoice in the Lord always. I will say it again: Rejoice!', pos: 'top-1/3 right-10' },
                { id: 4, title: 'Love', verse: '1 John 4:16', text: 'God is love. Whoever lives in love lives in God.', pos: 'bottom-1/4 left-10' },
                { id: 5, title: 'Christ', verse: 'John 1:5', text: 'The light shines in the darkness, and the darkness has not overcome it.', pos: 'center' }
            ];

            const handleStart = () => {
                audioManager.init();
                audioManager.playPad();
                setScreen('experience');
            };

            const handleTap = () => {
                if (candles.length >= sequence.length) return;

                const nextIndex = candles.length;
                const nextCandle = sequence[nextIndex];
                
                // Add new candle
                setCandles([...candles, nextCandle]);
                
                // Play sound
                audioManager.playChime();

                // Adjust lighting
                if (nextIndex < sequence.length - 1) {
                    setOpacity(prev => prev - 0.15); // Gradually lighten
                } else {
                    // Final candle logic
                    setOpacity(0.2); // Very bright
                    audioManager.playAngelChord();
                    setTimeout(() => setShowQuote(true), 1500);
                }
            };

            // --- Render Screens ---

            if (screen === 'start') {
                return (
                    <div className="h-screen w-full flex flex-col items-center justify-center relative overflow-hidden px-6">
                        <Snow />
                        
                        {/* Background Gradient */}
                        <div className="absolute inset-0 bg-gradient-to-b from-slate-900 to-[#0a0a20] -z-10"></div>
                        
                        <div className="z-10 text-center w-full max-w-md animate-[fadeIn_1s_ease-out]">
                            <div className="mb-8">
                                <svg className="w-16 h-16 mx-auto text-yellow-100 opacity-80 mb-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1">
                                    <path d="M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z" fill="currentColor" />
                                </svg>
                                <h1 className="text-4xl md:text-5xl font-title text-transparent bg-clip-text bg-gradient-to-r from-yellow-200 via-white to-yellow-200 tracking-wider mb-2">
                                    Light One Candle
                                </h1>
                                <p className="text-blue-200 italic font-light">A Christmas Reflection</p>
                            </div>

                            <div className="space-y-4 bg-white/5 backdrop-blur-sm p-8 rounded-2xl border border-white/10 shadow-xl">
                                <div>
                                    <p className="text-sm text-blue-100 mb-4 uppercase tracking-widest font-bold">Step 1: Submit Name</p>
                                    <a 
                                        href="https://forms.gle/cZZMZ1CGDkHuvEkp6" 
                                        target="_blank" 
                                        rel="noopener noreferrer"
                                        className="block w-full bg-blue-900/50 hover:bg-blue-800/50 border border-blue-400/30 text-blue-100 font-bold py-3 px-4 rounded-lg transition-all text-center uppercase tracking-wider mb-2"
                                    >
                                        Fill Out Form
                                        <span className="inline-block ml-2 text-xs opacity-70">↗</span>
                                    </a>
                                    <p className="text-xs text-blue-300/50 mb-6 italic">Opens in a new window. Return here after submitting.</p>
                                </div>

                                <div className="border-t border-white/10 pt-6">
                                    <p className="text-sm text-blue-100 mb-4 uppercase tracking-widest font-bold">Step 2: Light Candle</p>
                                    <button 
                                        onClick={handleStart}
                                        className="w-full bg-gradient-to-r from-amber-600 to-yellow-600 hover:from-amber-500 hover:to-yellow-500 text-white font-title font-bold py-4 rounded-lg shadow-lg shadow-amber-900/50 transform transition active:scale-95 uppercase tracking-widest"
                                    >
                                        Begin Journey
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }

            return (
                <div 
                    className="h-screen w-full relative overflow-hidden cursor-pointer select-none"
                    onClick={handleTap}
                >
                     {/* Dynamic Background Brightness */}
                     <div 
                        className="absolute inset-0 bg-[#050510] darkness-overlay z-0"
                        style={{ backgroundColor: `rgba(5, 5, 16, ${opacity})` }} 
                    ></div>
                    
                    {/* Stars in background */}
                    <div className="absolute inset-0 z-0 opacity-50">
                        {[...Array(20)].map((_, i) => (
                            <div 
                                key={i}
                                className="star absolute bg-white rounded-full"
                                style={{
                                    top: `${Math.random() * 100}%`,
                                    left: `${Math.random() * 100}%`,
                                    width: `${Math.random() * 3 + 1}px`,
                                    height: `${Math.random() * 3 + 1}px`,
                                    animationDelay: `${Math.random() * 5}s`
                                }}
                            ></div>
                        ))}
                    </div>

                    {/* Instruction Hint (Only at start) */}
                    {candles.length === 0 && (
                        <div className="absolute inset-0 flex items-center justify-center z-20 pointer-events-none">
                            <p className="text-blue-200/50 text-lg animate-pulse">Tap anywhere to light a candle...</p>
                        </div>
                    )}

                    {/* Render Candles */}
                    {candles.map((c, index) => {
                        const isCenter = c.pos === 'center';
                        
                        return (
                            <div 
                                key={c.id} 
                                className={`absolute ${isCenter ? '' : c.pos} z-10 transition-all duration-1000 flex flex-col items-center text-center fade-in max-w-[150px] md:max-w-[250px]`}
                                style={isCenter ? { top: '50%', left: '50%', transform: 'translate(-50%, -50%)', maxWidth: '90%' } : {}}
                            >
                                <div className="mb-4">
                                    <CandleGraphic scale={isCenter ? 1.5 : 0.8} />
                                </div>
                                
                                {!isCenter && (
                                    <div className="text-shadow-lg">
                                        <h3 className="text-yellow-400 font-title text-lg mb-1">{c.title}</h3>
                                        <p className="text-xs text-blue-200 uppercase tracking-widest mb-2">{c.verse}</p>
                                    </div>
                                )}
                            </div>
                        );
                    })}

                    {/* Final Overlay Content */}
                    {showQuote && (
                        <div className="absolute inset-0 z-50 flex flex-col items-center justify-center p-8 text-center fade-in-slow bg-black/20 backdrop-blur-[2px]">
                            
                            <div className="max-w-2xl bg-black/40 p-8 md:p-12 rounded-3xl border border-yellow-500/30 shadow-[0_0_100px_rgba(255,215,0,0.2)]">
                                <div className="mb-6">
                                    <h2 className="text-4xl md:text-6xl font-title text-yellow-100 mb-2 drop-shadow-[0_0_15px_rgba(255,255,255,0.5)]">Jesus</h2>
                                    <p className="text-yellow-500 uppercase tracking-[0.3em] text-sm">The Light of the World</p>
                                </div>

                                <blockquote className="text-xl md:text-2xl font-serif text-white italic mb-8 leading-relaxed">
                                    "{sequence[4].text}"
                                    <footer className="text-sm text-yellow-400/80 mt-2 not-italic font-sans uppercase tracking-widest">— John 1:5</footer>
                                </blockquote>

                                <div className="h-px w-24 bg-gradient-to-r from-transparent via-yellow-500 to-transparent mx-auto mb-8"></div>

                                <p className="text-lg md:text-xl text-blue-100 mb-10 font-light">
                                    Dear <span className="font-bold text-yellow-200">{name}</span>, may the light of Christ fill your heart this Christmas!
                                </p>
                                
                                <div className="mt-8 text-xs text-blue-300/30 uppercase tracking-widest">
                                    Merry Christmas
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>

